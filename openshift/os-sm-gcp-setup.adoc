---
sidebar: sidebar 
permalink: openshift/os-sm-gcp-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP, Google Cloud Platform, Google Cloud, GCP 
summary:  
---
= Implantar e configurar o Red Hat OpenShift Container Platform no Google Cloud
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Esta seção descreve um fluxo de trabalho de alto nível sobre como configurar e gerenciar clusters OpenShift no GCP e implantar aplicativos com estado neles.  Ele mostra o uso do armazenamento Google Cloud NetApp Volumes e NetApp Cloud Volumes ONTAP com a ajuda do Trident para fornecer volumes persistentes.

Aqui está um diagrama que mostra os clusters implantados no GCP e conectados ao data center usando uma VPN.

image:rhhc-self-managed-gcp.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: Há várias maneiras de implantar clusters da plataforma Red Hat OpenShift Container no GCP.  Esta descrição de alto nível da configuração fornece links de documentação para o método específico que foi usado.  Você pode consultar os outros métodos nos links relevantes fornecidos nolink:os-solutions-resources.html["seção de recursos"] .

O processo de configuração pode ser dividido nas seguintes etapas:

.Instalar um cluster OCP no GCP a partir da CLI
* Certifique-se de que você atendeu a todos os pré-requisitos declaradoslink:https://docs.openshift.com/container-platform/4.13/installing/installing_gcp/installing-gcp-default.html["aqui"] .
* Para a conectividade VPN entre o ambiente local e o GCP, uma VM pfsense foi criada e configurada.  Para obter instruções, consulte https://docs.netgate.com/pfsense/en/latest/recipes/ipsec-s2s-psk.html["aqui"] .
+
** O endereço do gateway remoto no pfsense só pode ser configurado depois de criar um gateway VPN no Google Cloud Platform.
** Os endereços IP de rede remota para a Fase 2 podem ser configurados somente depois que o programa de instalação do cluster OpenShift for executado e criar os componentes de infraestrutura para o cluster.
** A VPN no Google Cloud só pode ser configurada depois que os componentes de infraestrutura do cluster forem criados pelo programa de instalação.


* Agora instale o cluster OpenShift no GCP.
+
** Obtenha o programa de instalação e o pull secret e implante o cluster seguindo as etapas fornecidas na documentação https://docs.openshift.com/container-platform/4.13/installing/installing_gcp/installing-gcp-default.html["aqui"] .
** A instalação cria uma rede VPC no Google Cloud Platform.  Ele também cria uma zona privada no Cloud DNS e adiciona registros A.
+
*** Use o endereço do bloco CIDR da rede VPC para configurar o pfsense e estabelecer a conexão VPN.  Certifique-se de que os firewalls estejam configurados corretamente.
*** Adicione registros A no DNS do ambiente local usando o endereço IP nos registros A do DNS do Google Cloud.


** A instalação do cluster será concluída e fornecerá um arquivo kubeconfig, nome de usuário e senha para efetuar login no console do cluster.




.Implantar o Google Cloud NetApp Volumes
* Os Google Cloud NetApp Volumes podem ser adicionados aos seus projetos conforme descritolink:https://cloud.google.com/netapp/volumes/docs/discover/overview["aqui"] .


.Implantar o Cloud Volumes ONTAP no GCP usando o BlueXP
* Instale um conector no Google Cloud.  Consulte as instruções https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-google-bluexp-gcloud.html["aqui"] .
* Implante uma instância CVO no Google Cloud usando o conector.  Consulte as instruções aqui. https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-getting-started-gcp.html[]


.Instalar o Trident no cluster OCP no GCP
* Existem muitos métodos para implantar o Trident , conforme mostrado https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy.html["aqui"] .
* Para este projeto, o Trident foi instalado implantando o Trident Operator manualmente usando as instruções https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-operator.html["aqui"] .
* Crie classes de backend e armazenamento.  Consulte as instruçõeslink:https://docs.netapp.com/us-en/trident/trident-use/backends.html["aqui"] .


.Usando o recurso de topologia CSI do Trident para arquiteturas multizona
Os provedores de nuvem, hoje, permitem que os administradores de cluster do Kubernetes/OpenShift gerem nós dos clusters baseados em zonas.  Os nós podem estar localizados em diferentes zonas de disponibilidade dentro de uma região ou em várias regiões.  Para facilitar o provisionamento de volumes para cargas de trabalho em uma arquitetura multizona, o Trident usa a topologia CSI.  Usando o recurso Topologia CSI, o acesso aos volumes pode ser limitado a um subconjunto de nós, com base em regiões e zonas de disponibilidade.  Referirlink:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["aqui"] para obter detalhes adicionais.


NOTE: O Kubernetes oferece suporte a dois modos de vinculação de volume: - Quando **_VolumeBindingMode_ é definido como _Immediate_** (padrão), o Trident cria o volume sem qualquer reconhecimento de topologia.  Volumes persistentes são criados sem qualquer dependência dos requisitos de agendamento do pod solicitante.  - Quando **_VolumeBindingMode_ definido como _WaitForFirstConsumer_**, a criação e a vinculação de um Volume Persistente para um PVC são atrasadas até que um pod que usa o PVC seja agendado e criado.  Dessa forma, os volumes são criados para atender às restrições de agendamento impostas pelos requisitos de topologia.  Os backends de armazenamento Trident podem ser projetados para provisionar volumes seletivamente com base em zonas de disponibilidade (backend com reconhecimento de topologia).  Para StorageClasses que fazem uso desse backend, um volume só seria criado se solicitado por um aplicativo agendado em uma região/zona suportada.  (Classe de armazenamento com reconhecimento de topologia) Consultelink:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["aqui"] para obter detalhes adicionais.

[sublinhado]#*Vídeo de demonstração*#

.Instalação do OpenShift Cluster no Google Cloud Platform
video::4efc68f1-d37f-4cdd-874a-b09700e71da9[panopto,width=360]
.Importando clusters OpenShift para o Trident Protect
video::57b63822-6bf0-4d7b-b844-b09700eac6ac[panopto,width=360]