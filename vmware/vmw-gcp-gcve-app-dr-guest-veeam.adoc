---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-app-dr-guest-veeam.html 
keywords: gcp, gcve, snapcenter, cvo, iscsi, guest connect, dr, disaster recovery 
summary: A recuperação de desastres na nuvem é uma maneira resiliente e econômica de proteger cargas de trabalho contra interrupções do site e eventos de corrupção de dados, como ransomware.  Com o NetApp SnapMirror, as cargas de trabalho locais do VMware que usam armazenamento conectado ao convidado podem ser replicadas para o NetApp Cloud Volumes ONTAP em execução no Google Cloud. 
---
= Recuperação de desastres de aplicativos com SnapCenter, Cloud Volumes ONTAP e Veeam Replication
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
A recuperação de desastres na nuvem é uma maneira resiliente e econômica de proteger cargas de trabalho contra interrupções do site e eventos de corrupção de dados, como ransomware.  Com o NetApp SnapMirror, as cargas de trabalho locais do VMware que usam armazenamento conectado ao convidado podem ser replicadas para o NetApp Cloud Volumes ONTAP em execução no Google Cloud.



== Visão geral

Isso abrange dados de aplicativos; no entanto, e as VMs em si?  A recuperação de desastres deve abranger todos os componentes dependentes, incluindo máquinas virtuais, VMDKs, dados de aplicativos e muito mais.  Para fazer isso, o SnapMirror junto com o Veeam pode ser usado para recuperar perfeitamente cargas de trabalho replicadas do local para o Cloud Volumes ONTAP enquanto usa armazenamento vSAN para VMDKs de VM.

Este documento fornece uma abordagem passo a passo para configurar e executar a recuperação de desastres que usa o NetApp SnapMirror, o Veeam e o Google Cloud VMware Engine (GCVE).

image:dr-cvo-gcve-001.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]



== Suposições

Este documento se concentra no armazenamento no convidado para dados de aplicativos (também conhecido como convidado conectado), e presumimos que o ambiente local esteja usando o SnapCenter para backups consistentes com aplicativos.


NOTE: Este documento se aplica a qualquer solução de backup ou recuperação de terceiros.  Dependendo da solução usada no ambiente, siga as práticas recomendadas para criar políticas de backup que atendam aos SLAs organizacionais.

Para conectividade entre o ambiente local e a rede do Google Cloud, use opções de conectividade como interconexão dedicada ou Cloud VPN.  Os segmentos devem ser criados com base no design da VLAN local.


NOTE: Há várias opções para conectar datacenters locais ao Google Cloud, o que nos impede de descrever um fluxo de trabalho específico neste documento.  Consulte a documentação do Google Cloud para saber o método apropriado de conectividade local com o Google.



== Implementando a solução de DR



=== Visão geral da implantação da solução

. Certifique-se de que os dados do aplicativo sejam copiados usando o SnapCenter com os requisitos de RPO necessários.
. Provisione o Cloud Volumes ONTAP com o tamanho de instância correto usando o Cloud Manager dentro da assinatura e rede virtual apropriadas.
+
.. Configure o SnapMirror para os volumes de aplicativos relevantes.
.. Atualize as políticas de backup no SnapCenter para acionar atualizações do SnapMirror após os trabalhos agendados.


. Instale o software Veeam e comece a replicar máquinas virtuais para a instância do Google Cloud VMware Engine.
. Durante um evento de desastre, interrompa o relacionamento do SnapMirror usando o Cloud Manager e acione o failover de máquinas virtuais com o Veeam.
+
.. Reconecte os LUNs ISCSI e as montagens NFS para as VMs do aplicativo.
.. Abra inscrições on-line.


. Invoque o failback para o site protegido por meio da ressincronização reversa do SnapMirror após a recuperação do site primário.




=== Detalhes da implantação

.Configurar o CVO no Google Cloud e replicar volumes para o CVO
[%collapsible%open]
====
O primeiro passo é configurar o Cloud Volumes ONTAP no Google Cloud (link:vmw-gcp-gcve-guest-storage.html#gcp-cvo["cvo"^] ) e replicar os volumes desejados para o Cloud Volumes ONTAP com as frequências e retenções de snapshots desejadas.

image:dr-cvo-gcve-002.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Para obter instruções passo a passo sobre como configurar o SnapCenter e replicar os dados, consultelink:vmw-aws-vmc-guest-storage-dr.html#config-snapmirror["Configurar replicação com SnapCenter"]

.Configurar replicação com SnapCenter
video::395e33db-0d63-4e48-8898-b01200f006ca[panopto]
====
.Configurar hosts GCVE e acesso a dados CVO
[%collapsible%open]
====
Dois fatores importantes a serem considerados ao implantar o SDDC são o tamanho do cluster SDDC na solução GCVE e por quanto tempo o SDDC será mantido em serviço.  Essas duas considerações importantes para uma solução de recuperação de desastres ajudam a reduzir os custos operacionais gerais.  O SDDC pode ter apenas três hosts ou até mesmo um cluster de vários hosts em uma implantação em grande escala.

O Cloud Volumes ONTAP pode ser implantado em qualquer VPC e o GCVE deve ter conexão privada com essa VPC para que a VM se conecte aos LUNs iSCSI.

Para configurar o GCVE SDDC, consultelink:vmw-gcp-gcve-setup.html["Implantar e configurar o ambiente de virtualização no Google Cloud Platform (GCP)"^] .  Como pré-requisito, verifique se as VMs convidadas que residem nos hosts GCVE conseguem consumir dados do Cloud Volumes ONTAP depois que a conectividade for estabelecida.

Depois que o Cloud Volumes ONTAP e o GCVE forem configurados corretamente, comece a configurar o Veeam para automatizar a recuperação de cargas de trabalho locais para o GCVE (VMs com VMDKs de aplicativo e VMs com armazenamento no guest) usando o recurso Veeam Replication e aproveitando o SnapMirror para cópias de volumes de aplicativo para o Cloud Volumes ONTAP.

====
.Instalar componentes Veeam
[%collapsible%open]
====
Com base no cenário de implantação, o servidor de backup, o repositório de backup e o proxy de backup da Veeam precisam ser implantados.  Para este caso de uso, não há necessidade de implantar o repositório de objetos para o Veeam e o repositório de escalonamento também não é obrigatório.https://helpcenter.veeam.com/docs/backup/qsg_vsphere/deployment_scenarios.html["Consulte a documentação do Veeam para o procedimento de instalação"]

====
.Configurar replicação de VM com Veeam
[%collapsible%open]
====
Tanto o vCenter local quanto o vCenter GCVE precisam ser registrados no Veeam. https://helpcenter.veeam.com/docs/backup/qsg_vsphere/replication_job.html["Configurar tarefa de replicação de VM do vSphere"]  Na etapa Processamento de Convidado do assistente, selecione desabilitar processamento de aplicativo, pois utilizaremos o SnapCenter para backup e recuperação com reconhecimento de aplicativo.

.Configurar tarefa de replicação de VM do vSphere
video::8b7e4a9b-7de1-4d48-a8e2-b01200f00692[panopto]
====
.Failover da VM do Microsoft SQL Server
[%collapsible%open]
====
.Failover da VM do Microsoft SQL Server
video::9762dc99-081b-41a2-ac68-b01200f00ac0[panopto]
====


== Benefícios desta solução

* Utiliza a replicação eficiente e resiliente do SnapMirror.
* Recupera para quaisquer pontos disponíveis no tempo com retenção de instantâneos ONTAP .
* A automação completa está disponível para todas as etapas necessárias para recuperar centenas a milhares de VMs, desde as etapas de armazenamento, computação, rede e validação de aplicativos.
* O SnapCenter usa mecanismos de clonagem que não alteram o volume replicado.
+
** Isso evita o risco de corrupção de dados para volumes e instantâneos.
** Evita interrupções de replicação durante fluxos de trabalho de teste de DR.
** Aproveita os dados de DR para fluxos de trabalho além de DR, como desenvolvimento/teste, testes de segurança, testes de patch e atualização e testes de remediação.


* O Veeam Replication permite alterar endereços IP de VM no site de DR.

