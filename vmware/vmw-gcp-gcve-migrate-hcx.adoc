---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-migrate-hcx.html 
keywords: gcp, gcve, hybrid, multicloud, migrate, vmware, hcx, google, cloud, enterprise, hybrid, cloud, migration 
summary:  
---
= Migrar cargas de trabalho para o armazenamento de dados do Google Cloud NetApp Volumes no Google Cloud VMware Engine usando o VMware HCX - Guia de início rápido
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Um dos casos de uso mais comuns para o armazenamento de dados do Google Cloud VMware Engine e do Cloud Volume Service é a migração de cargas de trabalho do VMware.  O VMware HCX é uma opção preferencial e fornece vários mecanismos de migração para mover máquinas virtuais (VMs) locais e seus dados para armazenamentos de dados NFS do Cloud Volume Service.



== Visão geral: Migrando máquinas virtuais com VMware HCX, datastores do Google Cloud NetApp Volumes e Google Cloud VMware Engine (GCVE)

O VMware HCX é principalmente uma plataforma de migração projetada para simplificar a migração de aplicativos, o rebalanceamento de carga de trabalho e até mesmo a continuidade dos negócios entre nuvens.  Ele está incluído como parte do Google Cloud VMware Engine Private Cloud e oferece muitas maneiras de migrar cargas de trabalho e pode ser usado para operações de recuperação de desastres (DR).

Este documento fornece orientação passo a passo para provisionar o armazenamento de dados do Cloud Volume Service, seguido pelo download, implantação e configuração do VMware HCX, incluindo todos os seus principais componentes no local e no Google Cloud VMware Engine, incluindo interconexão, extensão de rede e otimização de WAN para habilitar vários mecanismos de migração de VM.


NOTE: O VMware HCX funciona com qualquer tipo de armazenamento de dados, pois a migração ocorre no nível da VM.  Portanto, este documento é aplicável a clientes atuais da NetApp e clientes não pertencentes à NetApp que planejam implantar o Cloud Volume Service com o Google Cloud VMware Engine para uma implantação de nuvem VMware econômica.

.Etapas de alto nível
[%collapsible%open]
====
Esta lista fornece as etapas de alto nível necessárias para emparelhar e migrar as VMs para o HCX Cloud Manager no lado do Google Cloud VMware Engine a partir do HCX Connector local:

. Prepare o HCX por meio do portal do Google VMware Engine.
. Baixe e implante o instalador do HCX Connector Open Virtualization Appliance (OVA) no VMware vCenter Server local.
. Ative o HCX com a chave de licença.
. Emparelhe o VMware HCX Connector local com o Google Cloud VMware Engine HCX Cloud Manager.
. Configure o perfil de rede, o perfil de computação e a malha de serviço.
. (Opcional) Execute a extensão da rede para evitar a troca de IP durante migrações.
. Valide o status do dispositivo e garanta que a migração seja possível.
. Migre as cargas de trabalho da VM.


====
.Pré-requisitos
[%collapsible%open]
====
Antes de começar, certifique-se de que os seguintes pré-requisitos sejam atendidos.  Para mais informações, consulte isto https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["link"^] .  Depois que os pré-requisitos, incluindo conectividade, estiverem prontos, baixe a chave de licença do HCX no portal do Google Cloud VMware Engine.  Após o download do instalador do OVA, prossiga com o processo de instalação conforme descrito abaixo.


NOTE: O HCX Advanced é a opção padrão e a edição VMware HCX Enterprise também está disponível por meio de um tíquete de suporte e tem suporte sem custo adicional.  Referir https://cloud.google.com/blog/products/compute/whats-new-with-google-cloud-vmware-engine["este link"^]

* Use um data center definido por software (SDDC) do Google Cloud VMware Engine existente ou crie uma nuvem privada usando estelink:vmw-gcp-gcve-setup.html["Link da NetApp"^] ou isto https://cloud.google.com/vmware-engine/docs/create-private-cloud["Link do Google"^] .
* A migração de VMs e dados associados do data center habilitado para VMware vSphere local requer conectividade de rede do data center para o ambiente SDDC.  Antes de migrar cargas de trabalho, https://cloud.google.com/vmware-engine/docs/networking/howto-connect-to-onpremises["configurar uma conexão Cloud VPN ou Cloud Interconnect"^] entre o ambiente local e a respectiva nuvem privada.
* O caminho de rede do ambiente VMware vCenter Server local para a nuvem privada do Google Cloud VMware Engine deve oferecer suporte à migração de VMs usando o vMotion.
* Certifique-se de que o necessário https://ports.esp.vmware.com/home/VMware-HCX["regras e portas de firewall"^] são permitidos para tráfego vMotion entre o vCenter Server local e o SDDC vCenter.
* O volume NFS do Cloud Volume Service deve ser montado como um armazenamento de dados no Google Cloud VMware Engine.  Siga os passos detalhados neste https://cloud.google.com/vmware-engine/docs/vmware-ecosystem/howto-cloud-volumes-service-datastores["link"^] para anexar armazenamentos de dados do Cloud Volume Service aos hosts do Google Cloud VMware Engines.


====
.Arquitetura de Alto Nível
[%collapsible%open]
====
Para fins de teste, o ambiente de laboratório local usado para esta validação foi conectado por meio de uma VPN na nuvem, que permite conectividade local com o Google Cloud VPC.

image:gcpd-hcx-001.png["Esta imagem descreve a arquitetura de alto nível usada nesta solução."]

Para obter mais detalhes sobre o uso do VMware HCX com o Google, consulte https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["Link VMware"^]

====


== Implantação de solução

Siga a série de etapas para concluir a implantação desta solução:

.Etapa 1: preparar o HCX por meio do portal do Google VMware Engine
[%collapsible%open]
====
O componente HCX Cloud Manager é instalado automaticamente conforme você provisiona a nuvem privada com o VMware Engine.  Para se preparar para o pareamento do site, conclua as seguintes etapas:

. Faça login no Google VMware Engine Portal e entre no HCX Cloud Manager.
+
Você pode fazer login no HCX Console clicando no link da versão HCXimage:gcpd-hcx-002.png["Acesso ao console HCX com link no recurso GCVE"] ou clicando em HCX FQDN na guia vSphere Management Network.image:gcpd-hcx-003.png["Acesso ao console HCX com link FQDN"]

. No HCX Cloud Manager, acesse *Administração > Atualizações do sistema*.
. Clique em *Solicitar link de download* e baixe o arquivo OVA.image:gcpd-hcx-004.png["Solicitar link para download"]
. Atualize o HCX Cloud Manager para a versão mais recente disponível na interface do usuário do HCX Cloud Manager.


====
.Etapa 2: implantar o instalador OVA no vCenter Server local
[%collapsible%open]
====
Para que o conector local se conecte ao HCX Manager no Google Cloud VMware Engine, certifique-se de que as portas de firewall apropriadas estejam abertas no ambiente local.

Para baixar e instalar o HCX Connector no vCenter Server local, conclua as seguintes etapas:

. Faça o download dos ova do Console HCX no Google Cloud VMware Engine, conforme indicado na etapa anterior.
. Após o download do OVA, implante-o no ambiente VMware vSphere local usando a opção *Implantar modelo OVF*.
+
image:gcpd-hcx-005.png["Captura de tela para selecionar o modelo OVA correto."]

. Insira todas as informações necessárias para a implantação do OVA, clique em *Avançar* e, em seguida, clique em *Concluir* para implantar o OVA do conector VMware HCX.
+

NOTE: Ligue o dispositivo virtual manualmente.



Para obter instruções passo a passo, consulte o https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx#prepare-for-hcx-manager-installation["Documentação do Google HCX"^] .

====
.Etapa 3: Ative o HCX Connector com a chave de licença
[%collapsible%open]
====
Depois de implantar o VMware HCX Connector OVA no local e iniciar o dispositivo, conclua as seguintes etapas para ativar o HCX Connector.  Gere a chave de licença no portal do Google Cloud VMware Engine e ative-a no VMware HCX Manager.

. No portal do VMware Engine, clique em Recursos, selecione a nuvem privada e *clique no ícone de download em Versão da nuvem do HCX Manager*. image:gcpd-hcx-006.png["Baixar licença HCX"] Abra o arquivo baixado e copie a sequência da chave de licença.
. Efetue login no VMware HCX Manager local em `"https://hcxmanagerIP:9443"` usando credenciais de administrador.
+

NOTE: Use o hcxmanagerIP e a senha definidos durante a implantação do OVA.

. No licenciamento, insira a chave copiada do passo 3 e clique em *Ativar*.
+

NOTE: O conector HCX local deve ter acesso à Internet.

. Em *Local do datacenter*, forneça o local mais próximo para instalar o VMware HCX Manager no local.  Clique em *Continuar*.
. Em *Nome do sistema*, atualize o nome e clique em *Continuar*.
. Clique em *Sim, Continuar*.
. Em *Conectar seu vCenter*, forneça o nome de domínio totalmente qualificado (FQDN) ou endereço IP do vCenter Server e as credenciais apropriadas e clique em *Continuar*.
+

NOTE: Use o FQDN para evitar problemas de conectividade mais tarde.

. Em *Configurar SSO/PSC*, forneça o FQDN ou endereço IP do Controlador de Serviços de Plataforma (PSC) e clique em *Continuar*.
+

NOTE: Para PSC incorporado, insira o FQDN ou endereço IP do VMware vCenter Server.

. Verifique se as informações inseridas estão corretas e clique em *Reiniciar*.
. Após a reinicialização dos serviços, o vCenter Server é exibido em verde na página que aparece.  Tanto o vCenter Server quanto o SSO devem ter os parâmetros de configuração apropriados, que devem ser os mesmos da página anterior.
+

NOTE: Esse processo deve levar aproximadamente de 10 a 20 minutos para que o plug-in seja adicionado ao vCenter Server.

+
image:gcpd-hcx-007.png["Captura de tela mostrando o processo concluído."]



====
.Etapa 4: emparelhe o VMware HCX Connector local com o Google Cloud VMware Engine HCX Cloud Manager
[%collapsible%open]
====
Depois que o HCX Connector for implantado e configurado no vCenter local, estabeleça a conexão com o Cloud Manager adicionando o emparelhamento.  Para configurar o pareamento de sites, conclua as seguintes etapas:

. Para criar um par de sites entre o ambiente vCenter local e o Google Cloud VMware Engine SDDC, faça login no vCenter Server local e acesse o novo plug-in HCX vSphere Web Client.
+
image:gcpd-hcx-008.png["Captura de tela do plug-in HCX vSphere Web Client."]

. Em Infraestrutura, clique em *Adicionar um pareamento de sites*.
+

NOTE: Insira o URL ou endereço IP do Google Cloud VMware Engine HCX Cloud Manager e as credenciais do usuário com privilégios Cloud-Owner-Role para acessar a nuvem privada.

+
image:gcpd-hcx-009.png["URL da captura de tela ou endereço IP e credenciais para a função CloudOwner."]

. Clique em *Conectar*.
+

NOTE: O VMware HCX Connector deve ser capaz de rotear para o IP do HCX Cloud Manager pela porta 443.

. Após a criação do pareamento, o pareamento do site recém-configurado fica disponível no Painel do HCX.
+
image:gcpd-hcx-010.png["Captura de tela do processo concluído no painel do HCX."]



====
.Etapa 5: configurar o perfil de rede, o perfil de computação e a malha de serviço
[%collapsible%open]
====
O dispositivo de serviço VMware HCX Interconnect fornece recursos de replicação e migração baseados em vMotion pela Internet e conexões privadas com o site de destino.  A interconexão fornece criptografia, engenharia de tráfego e mobilidade de VM.  Para criar um dispositivo de serviço de interconexão, conclua as seguintes etapas:

. Em Infraestrutura, selecione *Interconexão > Malha de serviço multisite > Perfis de computação > Criar perfil de computação*.
+

NOTE: Os perfis de computação definem os parâmetros de implantação, incluindo os dispositivos que são implantados e quais partes do data center VMware são acessíveis ao serviço HCX.

+
image:gcpd-hcx-011.png["Captura de tela da página de interconexão do cliente vSphere."]

. Após a criação do perfil de computação, crie os perfis de rede selecionando *Multi-Site Service Mesh > Perfis de rede > Criar perfil de rede*.
+
O perfil de rede define um intervalo de endereços IP e redes que são usados pelo HCX para seus dispositivos virtuais.

+

NOTE: Esta etapa requer dois ou mais endereços IP.  Esses endereços IP são atribuídos pela rede de gerenciamento aos dispositivos de interconexão.

+
image:gcpd-hcx-012.png["Captura de tela do perfil de rede."]

. Neste momento, os perfis de computação e rede foram criados com sucesso.
. Crie o Service Mesh selecionando a aba *Service Mesh* dentro da opção *Interconnect* e selecione os sites SDDC locais e GCVE.
. O Service Mesh especifica um par de perfis de computação e rede locais e remotos.
+

NOTE: Como parte desse processo, os dispositivos HCX são implantados e configurados automaticamente nos sites de origem e de destino para criar uma estrutura de transporte segura.

+
image:gcpd-hcx-013.png["Captura de tela da guia Service Mesh na página de interconexão do cliente vSphere."]

. Esta é a etapa final da configuração.  A implantação deve levar cerca de 30 minutos para ser concluída.  Após a configuração da malha de serviço, o ambiente estará pronto com os túneis IPsec criados com sucesso para migrar as VMs de carga de trabalho.
+
image:gcpd-hcx-014.png["Captura de tela dos dispositivos HCX na página de interconexão do cliente vSphere."]



====
.Etapa 6: migrar cargas de trabalho
[%collapsible%open]
====
As cargas de trabalho podem ser migradas bidirecionalmente entre SDDCs locais e GCVE usando várias tecnologias de migração do VMware HCX.  As VMs podem ser movidas de e para entidades ativadas pelo VMware HCX usando diversas tecnologias de migração, como migração em massa do HCX, HCX vMotion, migração a frio do HCX, HCX Replication Assisted vMotion (disponível com a edição HCX Enterprise) e HCX OS Assisted Migration (disponível com a edição HCX Enterprise).

Para saber mais sobre os vários mecanismos de migração do HCX, consulte https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["Migrando VMs VMware usando a documentação do VMware HCX"^] .

O dispositivo HCX-IX usa o serviço Mobility Agent para executar migrações vMotion, Cold e Replication Assisted vMotion (RAV).


NOTE: O dispositivo HCX-IX adiciona o serviço Mobility Agent como um objeto de host no vCenter Server.  Os recursos de processador, memória, armazenamento e rede exibidos neste objeto não representam o consumo real no hipervisor físico que hospeda o dispositivo IX.

*HCX vMotion*

Esta seção descreve o mecanismo HCX vMotion.  Esta tecnologia de migração usa o protocolo VMware vMotion para migrar uma VM para o GCVE.  A opção de migração vMotion é usada para migrar o estado de uma única VM por vez.  Não há interrupção de serviço durante este método de migração.


NOTE: A extensão de rede deve estar em vigor (para o grupo de portas no qual a VM está conectada) para migrar a VM sem a necessidade de fazer uma alteração de endereço IP.

. No cliente vSphere local, acesse Inventário, clique com o botão direito do mouse na VM a ser migrada e selecione Ações do HCX > Migrar para o site de destino do HCX.
+
image:gcpd-hcx-015.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

. No assistente Migrar Máquina Virtual, selecione Conexão de Site Remoto (GCVE de destino).
+
image:gcpd-hcx-016.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

. Atualize os campos obrigatórios (Cluster, Armazenamento e Rede de Destino), clique em Validar.
+
image:gcpd-hcx-017.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

. Após a conclusão das verificações de validação, clique em Ir para iniciar a migração.
+

NOTE: A transferência vMotion captura a memória ativa da VM, seu estado de execução, seu endereço IP e seu endereço MAC.  Para obter mais informações sobre os requisitos e limitações do HCX vMotion, consulte https://techdocs.broadcom.com/us/en/vmware-cis/hcx/vmware-hcx/4-10/vmware-hcx-user-guide-4-10/migrating-virtual-machines-with-vmware-hcx/understanding-vmware-hcx-vmotion-and-cold-migration.html#GUID-517866F6-AF06-4EFC-8FAE-DA067418D584-en["Compreendendo o VMware HCX vMotion e a migração a frio"^] .

. Você pode monitorar o progresso e a conclusão do vMotion no painel HCX > Migração.
+
image:gcpd-hcx-018.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]




NOTE: O armazenamento de dados NFS do Google Cloud NetApp Volumes (NetApp Volumes) de destino deve ter espaço suficiente para lidar com a migração.

====


== Conclusão

Não importa se você está visando nuvem híbrida ou totalmente em nuvem e dados residindo em qualquer tipo/fornecedor de armazenamento no local, o Cloud Volume Service e o HCX oferecem excelentes opções para implantar e migrar as cargas de trabalho do aplicativo, ao mesmo tempo em que reduzem o TCO ao tornar os requisitos de dados integrados à camada do aplicativo.  Seja qual for o caso de uso, escolha o Google Cloud VMware Engine junto com o Cloud Volume Service para rápida concretização dos benefícios da nuvem, infraestrutura consistente e operações em nuvens locais e múltiplas, portabilidade bidirecional de cargas de trabalho e capacidade e desempenho de nível empresarial.  É o mesmo processo e procedimento familiar usado para conectar o armazenamento e migrar VMs usando VMware vSphere Replication, VMware vMotion ou até mesmo cópia de arquivo de rede (NFC).



== Takeaways

Os pontos principais deste documento incluem:

* Agora você pode usar o Cloud Volume Service como um armazenamento de dados no Google Cloud VMware Engine SDDC.
* Você pode migrar facilmente dados do local para o armazenamento de dados do Cloud Volume Service.
* Você pode facilmente aumentar e diminuir o armazenamento de dados do Cloud Volume Service para atender aos requisitos de capacidade e desempenho durante a atividade de migração.




== Vídeos do Google e VMware para referência

.Do Google
[%collapsible%open]
====
* link:https://www.youtube.com/watch?v=xZOtqiHY5Uw["Implantar o conector HCX com GCVE"]
* link:https://youtu.be/2ObPvekMlqA["Configurar o HCX ServiceMesh com GCVE"]
* link:https://youtu.be/zQSGq4STX1s["Migrar VM com HCX para GCVE"]


====
.Da VMware
[%collapsible%open]
====
* link:https://youtu.be/EFE5ZYFit3M["Implantação do conector HCX para GCVE"]
* link:https://youtu.be/uwRFFqbezIE["Configuração do HCX ServiceMesh para GCVE"]
* link:https://youtu.be/4KqL0Rxa3kM["Migração de carga de trabalho do HCX para o GCVE"]


====


== Onde encontrar informações adicionais

Para saber mais sobre as informações descritas neste documento, consulte os seguintes links do site:

* Documentação do Google Cloud VMware Engine
+
https://cloud.google.com/vmware-engine/docs/overview/["https://cloud.google.com/vmware-engine/docs/overview"^]

* Documentação do Cloud Volume Service
+
https://cloud.google.com/architecture/partners/netapp-cloud-volumes["https://cloud.google.com/architecture/partners/netapp-cloud-volumes"^]

* Guia do usuário do VMware HCX
+
https://docs.vmware.com/en/VMware-HCX/index.html["https://docs.vmware.com/en/VMware-HCX/index.html"^]


