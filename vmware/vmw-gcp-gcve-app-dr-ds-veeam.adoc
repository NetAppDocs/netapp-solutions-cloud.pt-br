---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-app-dr-ds-veeam.html 
keywords: gcp, gcve, snapcenter, cvo, gcnv, iscsi, guest connect, dr, disaster recovery 
summary: A recuperação de desastres na nuvem é uma maneira resiliente e econômica de proteger cargas de trabalho contra interrupções do site e eventos de corrupção de dados, como ransomware.  Com o NetApp SnapMirror, as cargas de trabalho locais do VMware que usam armazenamento conectado ao convidado podem ser replicadas para o NetApp Cloud Volumes ONTAP em execução no Google Cloud. 
---
= Recuperação de desastres consistente com aplicativos com NetApp SnapCenter e Veeam Replication
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
A recuperação de desastres na nuvem é uma maneira resiliente e econômica de proteger cargas de trabalho contra interrupções do site e eventos de corrupção de dados, como ransomware.  Com o NetApp SnapMirror, as cargas de trabalho locais do VMware que usam armazenamento conectado ao convidado podem ser replicadas para o NetApp Cloud Volumes ONTAP em execução no Google Cloud.



== Visão geral

Muitos clientes procuram uma solução eficaz de recuperação de desastres para suas VMs de aplicativos hospedadas no VMware vSphere.  Muitos deles usam sua solução de backup existente para executar a recuperação durante desastres.  Muitas vezes essa solução aumenta o RTO e não atende às expectativas.  Para reduzir o RPO e o RTO, a replicação de VM da Veeam pode ser utilizada até mesmo do local para o GCVE, desde que a conectividade de rede e o ambiente com permissões apropriadas estejam disponíveis.  OBSERVAÇÃO: O Veeam VM Replication não protege dispositivos de armazenamento conectados a VMs convidadas, como montagens iSCSI ou NFS dentro da VM convidada.  É preciso proteger cada um separadamente.

Para replicação consistente de aplicativos para SQL VM e para reduzir o RTO, usamos o SnapCenter para orquestrar operações do SnapMirror de volumes de log e banco de dados SQL.

Este documento fornece uma abordagem passo a passo para configurar e executar a recuperação de desastres que usa o NetApp SnapMirror, o Veeam e o Google Cloud VMware Engine (GCVE).

image:dr-cvs-gcve-veeam-001.png["Arquitetura de replicação de VM de aplicativo"]



== Suposições

Este documento se concentra no armazenamento no convidado para dados de aplicativos (também conhecido como convidado conectado), e presumimos que o ambiente local esteja usando o SnapCenter para backups consistentes com aplicativos.


NOTE: Este documento se aplica a qualquer solução de backup ou recuperação de terceiros.  Dependendo da solução usada no ambiente, siga as práticas recomendadas para criar políticas de backup que atendam aos SLAs organizacionais.

Para conectividade entre o ambiente local e a rede do Google Cloud, use opções de conectividade como interconexão dedicada ou Cloud VPN.  Os segmentos devem ser criados com base no design da VLAN local.


NOTE: Há várias opções para conectar datacenters locais ao Google Cloud, o que nos impede de descrever um fluxo de trabalho específico neste documento.  Consulte a documentação do Google Cloud para saber o método apropriado de conectividade local com o Google.



== Implementando a solução de DR



=== Visão geral da implantação da solução

. Certifique-se de que os dados do aplicativo sejam copiados usando o SnapCenter com os requisitos de RPO necessários.
. Provisione o Cloud Volumes ONTAP com o tamanho de instância correto usando o BlueXP dentro da assinatura e rede virtual apropriadas.
+
.. Configure o SnapMirror para os volumes de aplicativos relevantes.
.. Atualize as políticas de backup no SnapCenter para acionar atualizações do SnapMirror após os trabalhos agendados.


. Instale o software Veeam e comece a replicar máquinas virtuais para a instância do Google Cloud VMware Engine.
. Durante um evento de desastre, interrompa o relacionamento do SnapMirror usando o BlueXP e acione o failover de máquinas virtuais com o Veeam.
+
.. Reconecte os LUNs ISCSI e as montagens NFS para as VMs do aplicativo.
.. Abra inscrições on-line.


. Invoque o failback para o site protegido por meio da ressincronização reversa do SnapMirror após a recuperação do site primário.




=== Detalhes da implantação

.Configurar o CVO no Google Cloud e replicar volumes para o CVO
[%collapsible%open]
====
O primeiro passo é configurar o Cloud Volumes ONTAP no Google Cloud (link:vmw-gcp-gcve-guest-storage.html["cvo"^] ) e replicar os volumes desejados para o Cloud Volumes ONTAP com as frequências e retenções de snapshots desejadas.

image:dr-cvo-gcve-002.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Para obter instruções passo a passo sobre como configurar o SnapCenter e replicar os dados, consultelink:vmw-aws-vmc-guest-storage-dr.html#config-snapmirror["Configurar replicação com SnapCenter"]

.Revisão da proteção de VM SQL com SnapCenter
video::395e33db-0d63-4e48-8898-b01200f006ca[panopto]
====
.Configurar hosts GCVE e acesso a dados CVO
[%collapsible%open]
====
Dois fatores importantes a serem considerados ao implantar o SDDC são o tamanho do cluster SDDC na solução GCVE e por quanto tempo o SDDC será mantido em serviço.  Essas duas considerações importantes para uma solução de recuperação de desastres ajudam a reduzir os custos operacionais gerais.  O SDDC pode ter apenas três hosts ou até mesmo um cluster de vários hosts em uma implantação em grande escala.

O Google Cloud NetApp Volumes para NFS Datastore e o Cloud Volumes ONTAP para bancos de dados e logs SQL podem ser implantados em qualquer VPC e o GCVE deve ter conexão privada com essa VPC para montar o NFS Datastore e fazer com que a VM se conecte aos LUNs iSCSI.

Para configurar o GCVE SDDC, consultelink:vmw-gcp-gcve-setup.html["Implantar e configurar o ambiente de virtualização no Google Cloud Platform (GCP)"^] .  Como pré-requisito, verifique se as VMs convidadas que residem nos hosts GCVE conseguem consumir dados do Cloud Volumes ONTAP depois que a conectividade for estabelecida.

Depois que o Cloud Volumes ONTAP e o GCVE forem configurados corretamente, comece a configurar o Veeam para automatizar a recuperação de cargas de trabalho locais para o GCVE (VMs com VMDKs de aplicativo e VMs com armazenamento no guest) usando o recurso Veeam Replication e aproveitando o SnapMirror para cópias de volumes de aplicativo para o Cloud Volumes ONTAP.

====
.Instalar componentes Veeam
[%collapsible%open]
====
Com base no cenário de implantação, o servidor de backup, o repositório de backup e o proxy de backup da Veeam precisam ser implantados.  Para este caso de uso, não há necessidade de implantar o repositório de objetos para o Veeam e o repositório de escalonamento também não é obrigatório. https://helpcenter.veeam.com/docs/backup/vsphere/replication_components.html?ver=120["Consulte a documentação do Veeam para o procedimento de instalação"] Para obter informações adicionais, consultelink:vmw-gcp-gcve-migrate-veeam.html["Migração com Veeam Replication"]

====
.Configurar replicação de VM com Veeam
[%collapsible%open]
====
Tanto o vCenter local quanto o vCenter GCVE precisam ser registrados no Veeam. https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["Configurar tarefa de replicação de VM do vSphere"]  Na etapa Processamento de Convidado do assistente, selecione desabilitar processamento de aplicativo, pois utilizaremos o SnapCenter para backup e recuperação com reconhecimento de aplicativo.

video::8b7e4a9b-7de1-4d48-a8e2-b01200f00692[panopto,width=360]
====
.Failover da VM do Microsoft SQL Server
[%collapsible%open]
====
video::9762dc99-081b-41a2-ac68-b01200f00ac0[panopto,width=360]
====


== Benefícios desta solução

* Utiliza a replicação eficiente e resiliente do SnapMirror.
* Recupera para quaisquer pontos disponíveis no tempo com retenção de instantâneos ONTAP .
* A automação completa está disponível para todas as etapas necessárias para recuperar centenas a milhares de VMs, desde as etapas de armazenamento, computação, rede e validação de aplicativos.
* O SnapCenter usa mecanismos de clonagem que não alteram o volume replicado.
+
** Isso evita o risco de corrupção de dados para volumes e instantâneos.
** Evita interrupções de replicação durante fluxos de trabalho de teste de DR.
** Aproveita os dados de DR para fluxos de trabalho além de DR, como desenvolvimento/teste, testes de segurança, testes de patch e atualização e testes de remediação.


* O Veeam Replication permite alterar endereços IP de VM no site de DR.

